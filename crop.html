<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page</title>
    <link rel="stylesheet" href="crop.css">
    <style>
        /* Footer Styles */
        footer {
            background-color: #2c3e50; /* Dark Blue */
            color: #ffffff; /* White */
            text-align: center;
            padding: 20px;
            width: 100%;
            position: fixed;
            bottom: 0;
            left: 0;
        }

        /* Pagination Styles */
        .pagination {
            text-align: center;
            margin-top: 20px;
            position: fixed;
            bottom: 70px; /* Adjust as needed */
            left: 50%;
            transform: translateX(-50%);
            z-index: 999; /* Ensure it's above other elements */
        }

        .btn {
            background-color: #007bff; /* Blue */
            color: #ffffff; /* White */
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }

        .btn:hover {
            background-color: #0056b3; /* Darker Blue on hover */
        }

        /* Autocomplete Styles */
        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-top: none;
            background-color: #2c3e50;
            z-index: 999;
            width: 100%;
            max-height: 200px; /* Set a maximum height for the dropdown menu */
            overflow-y: auto; /* Enable vertical scrolling */
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            color: #ffffff; /* White */
        }

        .autocomplete-item:hover {
            background-color: #f1f1f1; /* Add a background color on hover */
            color: #000000; /* Black */
        }

        /* Style the input container to position the autocomplete items */
        .autocomplete {
            position: relative;
            display: inline-block;
        }

        /* Style the input field */
        #search {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            color: #000000; /* Black */
        }
    </style>
</head>

<body>
    <!-- Navigation bar -->
    <nav class="navbar" style="background-color: #2c3e50; color: #ffffff;">
        <ul class="nav-list">
            <li><button class="nav-button"><a href="home.html">Home</a></button></li>
            <li><button class="nav-button"><a href="crop.html">Crop</a></button></li>
            <li><button class="nav-button"><a href="fertilizer.html">Fertilizers</a></button></li>
            <li><button class="nav-button"><a href="pesticide.html">Pesticides</a></button></li>
            <li><button class="nav-button"><a href="about.html">About Us</a></button></li>
            <li><button class="nav-button"><a href="contact.html">Contact</a></button></li>
        </ul>
        <div class="rightNav">
            <!-- Autocomplete container -->
            <div class="autocomplete">
                <input type="text" name="search" id="search" placeholder="Search">
                <div class="autocomplete-items"></div>
            </div>
            <button class="btn btn-sm">Search</button>
        </div>
    </nav>

    <!-- Display fetched crop data -->
    <div class="crop-container">
        <div id="cropDetails" class="crop-details">
            <div class="crop-details-content">
                <!-- Other data goes here -->
                <h2>Crop Name</h2>
                <p><strong>Temperature:</strong> Crop Temperature</p>
                <p><strong>Duration:</strong> Crop Duration</p>
                <p><strong>Description:</strong> Crop Description</p>
                <p><strong>Profitable Soil Type:</strong> Crop Profitable Soil Type</p>
                <p><strong>Price Range:</strong> Crop Price Range</p>
            </div>
            <img src="data:image/jpeg;base64,IMAGE_DATA_HERE" alt="Crop Name" class="crop-image">
        </div>
        <div class="pagination">
            <button id="previousBtn" class="btn" onclick="previousCrop()">Previous</button>
            <button id="nextBtn" class="btn" onclick="nextCrop()">Next</button>
        </div>
    </div>

    <!-- Include jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Variables to store fetched crop data and current index
        let crops = [];
        let currentIndex = 0;

        // Function to fetch crop data from server
        function fetchCrops() {
            $.get('/crops', (data) => {
                crops = data;
                console.log("Crop data retrieved:", crops); // Debugging
                displayCrop(currentIndex);
            });
        }

        // Function to display crop details
        function displayCrop(index) {
            const crop = crops[index];
            if (!crop || !crop.Image || !crop.Image.data) {
                console.error('Error: Image data not available.');
                return;
            }

            // Convert image data to base64 string
            const imageData = arrayBufferToBase64(crop.Image.data);
            if (!imageData) {
                console.error('Error: Failed to convert image data to base64.');
                return;
            }

            // Display crop details using jQuery
            $('#cropDetails').html(`
                <div class="crop-details-content">
                    <h2>${crop.CropName}</h2>
                    <p><strong>Temperature:</strong> ${crop.Temperature}</p>
                    <p><strong>Duration:</strong> ${crop.Duration}</p>
                    <p><strong>Description:</strong> ${crop.Description}</p>
                    <p><strong>Profitable Soil Type:</strong> ${crop.ProfitableSoilType}</p>
                    <p><strong>Price Range:</strong> ${crop.PriceRange}</p>
                </div>
                <img src="data:image/jpeg;base64,${imageData}" alt="${crop.CropName}" class="crop-image">
            `);
        }

        // Function to convert array buffer to base64
        function arrayBufferToBase64(buffer) {
            let binary = '';
            const bytes = new Uint8Array(buffer);
            for (let i = 0; i < bytes.byteLength; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }

        // Function to show next crop
        function nextCrop() {
            if (currentIndex < crops.length - 1) {
                currentIndex++;
                displayCrop(currentIndex);
            }
        }

        // Function to show previous crop
        function previousCrop() {
            if (currentIndex > 0) {
                currentIndex--;
                displayCrop(currentIndex);
            }
        }

        // Load crop data when the page is ready
        $(document).ready(() => {
            fetchCrops();
        });

        // Autocomplete functionality
        $('#search').on('input', function() {
            const input = $(this).val().toLowerCase();
            const suggestions = crops.filter(crop => crop.CropName.toLowerCase().includes(input));
            displayAutocomplete(suggestions);
        });

        function displayAutocomplete(suggestions) {
            const autocompleteContainer = $('.autocomplete-items');
            autocompleteContainer.empty();
            suggestions.forEach(suggestion => {
                const item = `<div class="autocomplete-item" onclick="selectSuggestion('${suggestion.CropName}')">${suggestion.CropName}</div>`;
                autocompleteContainer.append(item);
            });
            autocompleteContainer.toggle(suggestions.length > 0); // Show/hide autocomplete based on suggestions
        }

        function selectSuggestion(suggestion) {
            $('#search').val(suggestion);
            $('.autocomplete-items').empty(); // Clear autocomplete items
            // Find the selected crop
            const selectedCrop = crops.find(crop => crop.CropName === suggestion);
            if (selectedCrop) {
                // Display details of the selected crop
                const selectedIndex = crops.indexOf(selectedCrop);
                currentIndex = selectedIndex;
                displayCrop(selectedIndex);
            }
        }
    </script>

    <footer>
        &copy; 2024 YourWebsite. All rights reserved.
    </footer>
</body>

</html>
